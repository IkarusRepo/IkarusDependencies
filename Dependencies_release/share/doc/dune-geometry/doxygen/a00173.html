<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>dune-geometry: Refinement implementation for simplices</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">dune-geometry
   &#160;<span id="projectnumber">2.7.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Refinement implementation for simplices<div class="ingroups"><a class="el" href="a00174.html">Refinement</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Refinement implementation for simplices:</div>
<div class="dyncontent">
<div class="center"><img src="a00173.png" border="0" usemap="#aa00173" alt=""/></div>
<map name="aa00173" id="aa00173">
<area shape="rect" href="a00174.html" title=" " alt="" coords="5,13,92,38"/>
<area shape="rect" title=" " alt="" coords="140,5,319,45"/>
</map>
</div>
<p>This is mainly based on Jürgen Beys <a href="http://www.igpm.rwth-aachen.de/bey/">http://www.igpm.rwth-aachen.de/bey/</a> dissertation. The relevant part is available from <a href="http://www.igpm.rwth-aachen.de/Download/reports/bey/simplex.ps.gz">http://www.igpm.rwth-aachen.de/Download/reports/bey/simplex.ps.gz</a>.</p>
<h1><a class="anchor" id="Terminology"></a>
Terminology</h1>
<dl>
<dt>Kuhn simplex </dt>
<dd>To triangulate hypercubes we use the Kuhn triangulation. The members of this triangulation we call <em>Kuhn simplices</em>. The Kuhn simplices are indexed by their corresponding permutation. </dd>
<dt>Kuhn0 simplex </dt>
<dd>The Kuhn simplex corresponding to the permutation number 0. </dd>
<dt>size of a Kuhn simplex </dt>
<dd>The size of a kuhn simplex is equal to the size of the hypercube that it triangulates. </dd>
<dt>width of a Kuhn simplex </dt>
<dd>See <em>size of a Kuhn simplex</em>. </dd>
</dl>
<h1><a class="anchor" id="KuhnSimplexIndexing"></a>
Describing Kuhn simplices by their permutation</h1>
<p>A Kuhn simplex of dimension n can be described by its size s and a permutation of the vector <img class="formulaInl" alt="$\vec{p}=(0,\ldots,n-1)$" src="form_8.png"/>. To get the coordinates of the corners <img class="formulaInl" alt="$\vec{x}_0,\ldots,\vec{x}_n$" src="form_9.png"/> of the simplex, you do as follows:</p><ul>
<li>Start at the origin <img class="formulaInl" alt="$\vec{x}_0$" src="form_10.png"/>.</li>
<li>For each dimension d from 0 to n-1:<ul>
<li><img class="formulaInl" alt="$\vec{x}_{d+1}:=\vec{x}_d+s\cdot\vec{e}_{p_d}$" src="form_11.png"/> ( <img class="formulaInl" alt="$\vec{e}_i$" src="form_12.png"/> is the unit vector in direction i.)</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="Kuhn0VertexCounting"></a>
Number of vertices in a Kuhn0 simplex</h1>
<p>Let N(n, x) be the number of gridpoints within an n-dimensional Kuhn0 simplex of x gridunits width.</p>
<p>The number of points in a 0-dimensional simplex is 1, independent of its width.</p>
<p>N(0, x) = 1</p>
<p>The recursion formula is</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[N(n+1,x)=\sum^x_{i=0}N(n,i)\]" src="form_13.png"/>
</p>
<p>We slice the n+1 dimensional simplex orthogonal to one of the dimensions and sum the number of points in the n dimensional subsimplices.</p>
<p>This formula is satisfied by the binomial coefficient</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[N(n,x)=\left({n+x}\atop x\right)\]" src="form_14.png"/>
</p>
<p>See Bronstein, Semendjajew, Musiol, Mühlig "Taschenbuch der
Mathematik" (1999), Formula (1.35c)</p>
<p>Observations:</p><ul>
<li>N(n, 0) = 1</li>
<li>N(n, x) = N(x, n)</li>
</ul>
<h1><a class="anchor" id="Kuhn0VertexIndexing"></a>
Index of a vertex within a Kuhn0 simplex</h1>
<div class="image">
<img src="simplexvertexindex.png" alt=""/>
<div class="caption">
The image shows the Kuhn0 tetrahedron of width 2 (wireframe). It is partitioned into a tetrahedron (green), a triangle (red), a line (blue), and a vertex (black), each of width 1 and each a Kuhn0 simplex.</div></div>
<p>Let us calculate the index of vertex 9, which has the coordinates <img class="formulaInl" alt="$(x_0,x_1,x_2)=(2,2,2)$" src="form_15.png"/>.</p><ul>
<li>First we count the number of vertices in the green tetrahedron of width <img class="formulaInl" alt="$x_0-1=1$" src="form_16.png"/> (4). Then we take the green tetrahedron away. Whats left is a triangle, which extends into the (1,2)-plane.</li>
<li>Now we count the number of vertices in the red triangle of width <img class="formulaInl" alt="$x_1-1=1$" src="form_17.png"/> (3). Again we take the counted points away and are left with a line which extends into direction 2.</li>
<li>We take the blue line of width <img class="formulaInl" alt="$x_2-1=1$" src="form_18.png"/>, count the number of vertices (2), and throw away the counted stuff. The only thing remaining is a point, so we're done.</li>
<li>We add the counted stuff together and get indeed 9.</li>
</ul>
<p>On to a more complicated example: vertex 6 with coordinates <img class="formulaInl" alt="$(x_0,x_1,x_2)=(2,1,1)$" src="form_19.png"/>.</p><ul>
<li>First count the vertices in the green tetrahedron again (width <img class="formulaInl" alt="$x_0-1=1$" src="form_16.png"/>). The result is 4.</li>
<li>Count the vertices in the triangle of width <img class="formulaInl" alt="$x_1-1=0$" src="form_20.png"/> (vertex 4), which is just a point. The result is 1.</li>
<li>Count the vertices in the line of width <img class="formulaInl" alt="$x_2-1=0$" src="form_21.png"/> (vertex 5), which is also just a point. The result is 1.</li>
<li>Add everything together and get 6.</li>
</ul>
<p>The general algorithm for n dimensions and a vertex with coordinates <img class="formulaInl" alt="$\vec{x}=(x_0,\ldots,x_{n-1})$" src="form_22.png"/> is as follows:</p><ul>
<li>For each dimension d from 0 to n-1<ul>
<li>Count the vertices in the n-d dimensional simplex of width <img class="formulaInl" alt="$x_d-1$" src="form_23.png"/>,</li>
</ul>
</li>
<li>Add all counts together to get the index of the vertex</li>
</ul>
<p>In formulas it looks like this:</p>
<p>Let <img class="formulaInl" alt="$I(n,\vec{x})$" src="form_24.png"/> be the index of point <img class="formulaInl" alt="$\vec{x}$" src="form_25.png"/> in the n-dimensional Kuhn0 simplex. The coordinates measure the position of the point in gridunits and thus are integer.</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[I(n,\vec{x})=\sum_{i=0}^{n-1}N(n-i,x_i-1)=\sum_{i=0}^{n-1}\left({n-i+x_i-1}\atop{n-i}\right)\]" src="form_26.png"/>
</p>
<p>Since the coordinates of a vertex within the Kuhn0 obey the relation <img class="formulaInl" alt="$x_0\geq x_1\geq\ldots\geq x_{n-1}$" src="form_27.png"/>, they cannot simply be swapped so the sum is somewhat ugly.</p>
<h1><a class="anchor" id="Kuhn0SubelementIndexing"></a>
Index of a subelement within a Kuhn0 simplex</h1>
<p>We don't know of a way to simply map a subelement of a Kuhn0 simplex to an index number. Luckily, the iterator interface only requires that we be able to calculate the next subelement.</p>
<p>Each subelement is a Kuhn (sub)simplex which triangulates a hypercube. We need to remember the vertex which is the origin of that hypercube and the index of the permutation of that identifies the Kuhn subsimplex. Now to get to the next subelement, we simply need to increment the permutation index, and if the overflows we reset it and increment the origin to the next vertex (we already know how to do that).</p>
<p>Some subelements generated this way are outside the refined Kuhn0 simplex, so we have to check for that, and skip them.</p>
<h1><a class="anchor" id="PermutationIndexing"></a>
Index of a permutation</h1>
<p>[NOTE: There may be some interesting stuff in <a href="http://en.wikipedia.org/wiki/Factoradic">http://en.wikipedia.org/wiki/Factoradic</a> . I was not aware of it while writing this code, however.]</p>
<p>We need to index the n! permutations of the integers from 0 to n-1 and a way to calculate the permutation if given the index.</p>
<p>I'll discuss the permutation P, which operates on a vector <img class="formulaInl" alt="$\vec{x}=(x_0,\ldots,x_{n-1})$" src="form_22.png"/>.</p>
<p>P can be made up of n transpositions, <img class="formulaInl" alt="$P=T_0\cdots T_{n-1}$" src="form_28.png"/>. Each transposition <img class="formulaInl" alt="$T_i$" src="form_29.png"/> exchanges some arbitrary element <img class="formulaInl" alt="$x_{t_i}$" src="form_30.png"/> with the element <img class="formulaInl" alt="$x_i$" src="form_31.png"/>, where <img class="formulaInl" alt="$t_i\leq i$" src="form_32.png"/>. So we can totally describe <img class="formulaInl" alt="$T_i$" src="form_29.png"/> by the integer <img class="formulaInl" alt="$t_i$" src="form_33.png"/>. Thus we can describe P by the integer vector <img class="formulaInl" alt="$\vec{t}=(t_0,\cdots,t_{n-1})$" src="form_34.png"/>, where <img class="formulaInl" alt="$0\leq t_i\leq i$" src="form_35.png"/>.</p>
<p>Now we need to encode the vector <img class="formulaInl" alt="$\vec{t}$" src="form_36.png"/> into a single number. To do that we view <img class="formulaInl" alt="$t_i$" src="form_33.png"/> as digit i of a number p written in a <em>base faculty notation</em>:</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[p=\sum_{i=1}^{n-1}i!t_i\]" src="form_37.png"/>
</p>
<p>This number p is unique for each possible permutation P so we could use this as index. There is a problem though: we would like the identity permutation <img class="formulaInl" alt="$\vec{x}=P\vec{x}$" src="form_38.png"/> to have index 0. So we define the index I of the permutation slightly differently:</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[I=\sum_{i=1}^{n-1}i!(i-t_i)\]" src="form_39.png"/>
</p>
<p>I can easily calculate the <img class="formulaInl" alt="$t_i$" src="form_33.png"/> from I:</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[i-t_i=(I/i!)\%(i+1)\]" src="form_40.png"/>
</p>
<p> ('/' is integer division and '' calculates the remainder).</p>
<h1><a class="anchor" id="KuhnToReference"></a>
Mapping between some Kuhn and the reference simplex</h1>
<div class="image">
<img src="referencetokuhn0.png" alt=""/>
<div class="caption">
Step 1 moves each point by its x2 value into x1 direction. Step 2 moves each point by its new x1 value into x0 direction.</div></div>
<p>The algorithm to transform a point <img class="formulaInl" alt="$\vec{x}=(x_0,\ldots,x_{n-1})$" src="form_22.png"/> from the reference simplex of dimension n to the Kuhn0 simplex (as illustrated in the image) is as follows:</p><ul>
<li>For each dimension d from n-2 down to 0:<ul>
<li><img class="formulaInl" alt="$x_d:=x_d+x_{d+1}$" src="form_41.png"/>.</li>
</ul>
</li>
</ul>
<p>The reverse (from Kuhn0 to reference) is simple as well:</p><ul>
<li>For each dimension d from 0 up to n-2:<ul>
<li><img class="formulaInl" alt="$x_d:=x_d-x_{d+1}$" src="form_42.png"/>.</li>
</ul>
</li>
</ul>
<dl class="section user"><dt>Arbitrary Kuhn simplices</dt><dd></dd></dl>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
